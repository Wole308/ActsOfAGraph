#ifndef KERNELPROCESS_H
#define KERNELPROCESS_H
#include <mutex>
#include <iostream>
#include <thread>
{%if(context['KERNELNAME'] == "ACTS")%}
#include "../kernels/acts.h"
{%else%}
#include "../kernels/enigma.h"
{%endif%}
#include "../src/common.h"

class kernelprocess {
public:
	kernelprocess();
	~kernelprocess();
	
	void topkernel(
		{%for ddrs, ddrs_ in zip(context['NUMINSTANCES_seq'], context['INSTANCES_charseq'])%}
		{%if(ddrs==0)%}{%else%},{%endif%}uint512_dt * kvsourcedram{{ddrs_}}
		{%endfor%}
		{%for ddrs, ddrs_ in zip(context['NUMINSTANCES_seq'], context['INSTANCES_charseq'])%}
		,uint512_dt * kvdestdram{{ddrs_}}
		{%endfor%}
		{%for ddrs, ddrs_ in zip(context['NUMINSTANCES_seq'], context['INSTANCES_charseq'])%}
		,keyvalue_t * kvstats{{ddrs_}}
		{%endfor%}
        );
	void topkernelMW(uint512_dt ** kvsourcedram, uint512_dt ** kvdestdram, keyvalue_t ** kvstats);
	
private:
	#ifdef SW
	#ifdef ACTS
	acts kernelobj;
	#else 
	enigma kernelobj;
	#endif 
	std::thread acts_thread[NUMDRAMBANKS];
	#endif
};
#endif 








